{"version":3,"sources":["index.js"],"names":["App","useState","data","setData","useEffect","window","fetch","then","response","json","d3","force","radius","d","Math","pow","count","strength","iterations","on","length","className","WordPlot","word","setWord","selectedWord","setSelectedWord","margin","width","height","color","cicleSize","xScale","domain","item","x","range","nice","yScale","y","style","fontSize","marginTop","marginBottom","viewBox","transform","map","i","key","onClick","onMouseEnter","onMouseLeave","cursor","r","fill","textAnchor","dominantBaseline","DrawDendrogram","projectData","setProjectData","projectName","setProjectName","ministries","setMinistries","selectedName","setSelectedName","selectedNodeName","setSelectedNodeName","displayedNodeName","setDisplayedNodeName","selectNodeLeaves","setSelectNodeLeaves","nodeLeavesData","setNodeLeavesData","dataPath","ministriesSet","Set","add","Array","from","newData","filter","newNodeLeavesData","node","project","push","事業名","執行額","補正予算","府省庁","contentWidth","ministriesCol","ministriesList","fillColor","ministryName","forEach","ministry","contentHeight","data_stratify","id","name","parentId","parent","stratify","root","size","separation","cluster","testData","descendants","shape","s","type","overflowX","slice","undefined","children","leaves","DrawStackedChart","ProjectTable","marginLeft","marginbottom","numberTotal","moneyTotal","labels","projectsMoneyDigit","1","2","3","4","5","6","7","8","numDigit","String","floor","stackChartData","keys","ticks","Number","isInteger","x1","y1","x2","y2","stroke","render","document","querySelector"],"mappings":"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","file":"static/js/main.9918dadd.chunk.js","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { render } from \"react-dom\";\nimport * as d3 from \"d3\";\nimport \"bulma/css/bulma.css\";\n\nconst App = () => {\n  const [data, setData] = useState([]);\n  const dataPath = \"./data/plot_test_data_25_DB_16_3.json\";\n\n  useEffect(() => {\n    window\n      .fetch(dataPath)\n      .then((response) => response.json())\n      .then((data) => {\n        d3.forceSimulation(data)\n          .force(\n            \"collide\",\n            d3\n              .forceCollide()\n              .radius(function (d) {\n                return Math.pow(d.count, 0.7) + 8.5;\n              })\n\n              .strength(0.015) // 0.01\n              .iterations(30)\n          )\n          .force(\"charge\", d3.forceManyBody().strength(1))\n          .force(\"center\", d3.forceCenter())\n          .on(\"end\", () => {\n            setData(data);\n          });\n      });\n  }, []);\n\n  if (data.length === 0) {\n    return <div>loading</div>;\n  } else {\n    return (\n      <div>\n        <div className=\"hero is-info is-bold\">\n          <div className=\"hero-body\">\n            <div className=\"container\">\n              <h1 className=\"title\">\n                類似事業探索の為の行政事業の俯瞰的可視化\n              </h1>\n              <h2 className=\"subtitle\">情報科学研究 国家財政チーム</h2>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"App\">\n          <WordPlot data={data} />\n        </div>\n\n        <footer className=\"footer\">\n          <div className=\"content has-text-centered\">\n            <p>&copy; 2020 上野瑞貴 野村理紗</p>\n          </div>\n        </footer>\n      </div>\n    );\n  }\n};\n\n//////////////////////////\nconst WordPlot = ({ data }) => {\n  const [word, setWord] = useState(\"\");\n  const [selectedWord, setSelectedWord] = useState(\"\");\n  const contentWidth = 460;\n  const contentHeight = 450;\n\n  const margin = {\n    left: 150,\n    right: 150,\n    top: 30,\n    bottom: 50,\n  };\n\n  const width = contentWidth + margin.left + margin.right;\n  const height = contentHeight + margin.top + margin.bottom;\n\n  const color = d3.scaleOrdinal(d3.schemeAccent);\n  const cicleSize = (d) => Math.pow(d.count, 0.7);\n\n  const xScale = d3\n    .scaleLinear()\n    .domain([d3.min(data, (item) => item.x), d3.max(data, (item) => item.x)])\n    .range([0, contentWidth])\n    .nice();\n\n  const yScale = d3\n    .scaleLinear()\n    .domain([d3.max(data, (item) => item.y), d3.min(data, (item) => item.y)])\n    .range([0, contentHeight])\n    .nice();\n\n  return (\n    <section className=\"section\">\n      <div className=\"container\">\n        <h1 className=\"title\">キーワードバブルチャート</h1>\n        <p>\n          2019年度公開の約5000の行政事業の事業概要からそれぞれキーワードを抽出し、キーワード毎に事業概要にキーワードが含まれている事業の執行額を担当府省庁別で集計をしてデータ作成を行いました。その結果を次元削減し、事業からキーワードを抽出した際に出現頻度の高かった117個のキーワードを二次元空間に表示しています。円の大きさはキーワードの出現頻度で決め、位置の近さで色付けしています。\n        </p>\n        <p\n          className=\"has-text-weight-bold\"\n          style={{\n            fontSize: \"large\",\n            marginTop: \"0.7rem\",\n            marginBottom: \"1.0rem\",\n          }}\n        >\n          キーワードをクリックするとクリックしたキーワードが事業概要に含まれる事業がページ下部に表示されます。\n        </p>\n\n        <svg viewBox={`0 0 ${width} ${height}`}>\n          <g transform={`translate(${margin.left}, ${margin.top})`}>\n            {data.map((item, i) => {\n              return (\n                <g\n                  key={i}\n                  onClick={() => {\n                    setWord(item.word);\n                  }}\n                  onMouseEnter={() => {\n                    setSelectedWord(item.word);\n                  }}\n                  onMouseLeave={() => {\n                    setSelectedWord(\"\");\n                  }}\n                  transform={`translate(${xScale(item.x)}, ${yScale(item.y)})`}\n                  style={{ cursor: \"pointer\" }}\n                >\n                  <title>{`word:${item.word}`}</title>\n                  <circle\n                    r={cicleSize(item)}\n                    fill={\n                      item.color === \"silver\" ? item.color : color(item.color)\n                    }\n                  />\n                  <text\n                    fontSize={`${cicleSize(item) * 0.77}px`}\n                    textAnchor=\"middle\"\n                    dominantBaseline=\"central\"\n                    fill={item.word === selectedWord ? \"blue\" : \"black\"}\n                  >\n                    {item.word}\n                  </text>\n                </g>\n              );\n            })}\n          </g>\n        </svg>\n      </div>\n      <div>\n        {word === \"\" ? (\n          <div>\n            キーワードをクリックするとここにデンドログラムが表示されます\n          </div>\n        ) : (\n          <DrawDendrogram word={word} />\n        )}\n      </div>\n    </section>\n  );\n};\n\n////////////////////////////\nconst DrawDendrogram = ({ word }) => {\n  const [data, setData] = useState([]);\n  const [projectData, setProjectData] = useState([]);\n  const [projectName, setProjectName] = useState(\"\");\n  const [ministries, setMinistries] = useState([]);\n  const [selectedName, setSelectedName] = useState(\"\");\n  const [selectedNodeName, setSelectedNodeName] = useState(\"\");\n  const [displayedNodeName, setDisplayedNodeName] = useState(\"\");\n  const [selectNodeLeaves, setSelectNodeLeaves] = useState([]);\n  const [nodeLeavesData, setNodeLeavesData] = useState([]);\n  const dataPath = `./data/dendrogramData2/${word}.json`;\n\n  useEffect(() => {\n    window\n      .fetch(dataPath)\n      .then((response) => response.json())\n      .then((data) => {\n        setData(data);\n      });\n  }, [dataPath]);\n\n  useEffect(() => {\n    window\n      .fetch(\"./data/tsne_+_clusters_list.json\")\n      .then((response) => response.json())\n      .then((data) => {\n        const ministriesSet = new Set();\n        data.map((item) => {\n          return ministriesSet.add(item[\"府省庁\"]);\n        });\n        setMinistries(Array.from(ministriesSet));\n\n        const newData = data.filter((item) => {\n          return item[\"公開年度\"] === \"2019\" && item[\"事業名\"] === projectName;\n        });\n        setProjectData(newData);\n      });\n  }, [projectName]);\n\n  useEffect(() => {\n    window\n      .fetch(\"./data/tsne_+_clusters_list.json\")\n      .then((response) => response.json())\n      .then((data) => {\n        const newNodeLeavesData = [];\n        for (const node of selectNodeLeaves) {\n          for (const project of data) {\n            if (\n              project[\"事業名\"] === node.data.data[\"事業名\"] &&\n              project[\"公開年度\"] === \"2019\" &&\n              project[\"府省庁\"] === node.data.data[\"府省庁\"]\n            ) {\n              newNodeLeavesData.push({\n                事業名: project[\"事業名\"],\n                執行額: +project[\"執行額\"],\n                補正予算: project[\"補正予算\"],\n                府省庁: project[\"府省庁\"],\n              });\n            }\n          }\n        }\n        setNodeLeavesData(newNodeLeavesData);\n      });\n  }, [selectNodeLeaves]);\n\n  if (data.length === 0) {\n    return <div></div>;\n  }\n\n  const fontSize = 10;\n  const separation = 5;\n  const contentWidth = (fontSize + separation) * (data.length / 2);\n  const contentHeight = 400;\n  const ministriesCol = d3.scaleOrdinal(d3.schemeCategory10);\n  //const ministriesCol = d3\n  //.scaleLinear()\n  //.domain([0, 4, 8, 12, 16, 20])\n  //.range([\"red\", \"orange\", \"yellow\", \"green\", \"blue\", \"purple\"]);\n\n  const margin = {\n    left: 160,\n    right: 200,\n    top: 75,\n    bottom: 150,\n  };\n\n  const ministriesList = [];\n  ministries.map((item, i) => {\n    return ministriesList.push({ 府省庁: item, color: ministriesCol(i) });\n  });\n\n  const fillColor = (ministryName) => {\n    let color = \"\";\n    ministriesList.forEach((ministry) => {\n      if (ministry[\"府省庁\"] === ministryName) {\n        color = ministry.color;\n      }\n    });\n    return color;\n  };\n\n  //const width = contentWidth + margin.left + margin.right;\n  const height = contentHeight + margin.top + margin.bottom;\n\n  const yScale = d3\n    .scaleLinear()\n    .domain([\n      d3.max(data, (item) => item.height),\n      d3.min(data, (item) => item.height),\n    ])\n    .range([0, contentHeight - 200]);\n\n  const stratify = d3\n    .stratify()\n    .id((d) => d.name)\n    .parentId((d) => d.parent);\n\n  const data_stratify = stratify(data);\n  const root = d3.hierarchy(data_stratify);\n  const cluster = d3\n    .cluster()\n    .size([contentWidth, contentHeight - 200])\n    .separation(() => separation);\n  cluster(root);\n\n  const testData = root.descendants();\n\n  const shape = d3.scaleOrdinal(\n    ministriesList.map((d) => d[\"府省庁\"]),\n    d3.symbols.map((s) => d3.symbol().type(s).size(90)())\n  );\n\n  return (\n    <div>\n      <h1 className=\"title\">事業概要に\"{word}\"を含む行政事業デンドログラム</h1>\n      <p>\n        ここではキーワードバブルチャートでクリックされたキーワードを事業概要に含む事業の事業概要をベクトル表現したデータを用いて階層クラスター分析を行い、その結果をデンドログラムで描画しています。図の下の方で結合している事業は近い関係にあるといえます。またある程度の高さでクラスタを見る事で事業をいくつかの事業群として見る事が可能です。\n      </p>\n      <p\n        className=\"has-text-weight-bold\"\n        style={{\n          fontSize: \"large\",\n          marginTop: \"0.7rem\",\n          marginBottom: \"2.0rem\",\n        }}\n      >\n        デンドログラムの事業名をクリックすると、事業の詳細がページ下部に表示されます。\n      </p>\n      <div style={{ overflowX: \"auto\" }}>\n        <svg width=\"1195\" height={margin.top}>\n          {ministriesList.map((item, i) => {\n            return (\n              <g\n                transform={`translate(${\n                  i < 7\n                    ? 50 + 160 * i\n                    : i < 14\n                    ? 50 + 160 * (i - 7)\n                    : 50 + 160 * (i - 14)\n                }, ${i < 7 ? 17 : i < 14 ? 34 : 51})`}\n              >\n                <path d={shape(item[\"府省庁\"])} fill={item.color} />\n                {/*<circle r=\"6\" fill={item.color} />*/}\n                <text x=\"7\" y=\"5\">\n                  {item[\"府省庁\"]}\n                </text>\n              </g>\n            );\n          })}\n        </svg>\n      </div>\n      <div style={{ overflowX: \"scroll\" }}>\n        <svg width={contentWidth + margin.right} height={height}>\n          <g transform={`translate(0,0)`}>\n            {testData.slice(1).map((item) => {\n              return (\n                <path\n                  className=\"link\"\n                  d={`M${item.x},${yScale(item.data.data.height)}\n                        L${item.x},${yScale(item.parent.data.data.height)}\n                        L${item.parent.x},${yScale(\n                    item.parent.data.data.height\n                  )}`}\n                />\n              );\n            })}\n\n            {testData.map((item, i) => {\n              return (\n                <g\n                  key={i}\n                  transform={`translate(${item.x},${yScale(\n                    item.data.data.height\n                  )})`}\n                  style={{ cursor: \"pointer\" }}\n                  onClick={() => {\n                    if (item.children !== undefined) {\n                      setSelectNodeLeaves(item.leaves());\n                      setDisplayedNodeName(item.data.data.name);\n                    } else {\n                      setProjectName(item.data.data[\"事業名\"]);\n                    }\n                  }}\n                  onMouseEnter={() => {\n                    if (item.children !== undefined) {\n                      setSelectedNodeName(item.data.data.name);\n                    }\n                    setSelectedName(item.data.data[\"事業名\"]);\n                  }}\n                  onMouseLeave={() => {\n                    if (item.children !== undefined) {\n                      setSelectedNodeName(\"\");\n                    }\n                    setSelectedName(\"\");\n                  }}\n                >\n                  {item.children ? (\n                    <circle\n                      r={item.children ? \"3\" : \"6\"}\n                      fill={\n                        selectedNodeName === item.data.data.name\n                          ? \"blue\"\n                          : displayedNodeName === item.data.data.name\n                          ? \"brown\"\n                          : \"black\"\n                      }\n                    ></circle>\n                  ) : (\n                    <path\n                      d={shape(item.data.data[\"府省庁\"])}\n                      fill={fillColor(item.data.data[\"府省庁\"])}\n                    />\n                  )}\n                  {/*<circle\n                    r={item.children ? \"2\" : \"6\"}\n                    fill={fillColor(item.data.data[\"府省庁\"])}\n                  ></circle>*/}\n                  <text\n                    transform=\"translate(-3,10) rotate(45)\"\n                    y={item.children ? -10 : 2}\n                    x=\"0\"\n                    fontSize={`${fontSize}px`}\n                    textAnchor={item.children ? \"end\" : \"start\"}\n                    fill={\n                      item.data.data[\"事業名\"] === selectedName\n                        ? \"blue\"\n                        : item.data.data[\"事業名\"] === projectName\n                        ? \"brown\"\n                        : \"black\"\n                    }\n                  >\n                    {item.children ? null : item.data.data[\"事業名\"]}\n                  </text>\n                </g>\n              );\n            })}\n          </g>\n        </svg>\n      </div>\n      <div className=\"columns\">\n        <div className=\"column is-6\">\n          {nodeLeavesData.length === 0 ? (\n            <div>ノードをクリックすると下</div>\n          ) : (\n            <DrawStackedChart nodeLeavesData={nodeLeavesData} />\n          )}\n        </div>\n        <div className=\"column is-6\">\n          {projectData.length === 0 ? (\n            <div>事業名をクリックするとここに事業の詳細が表示されます</div>\n          ) : (\n            <ProjectTable projectData={projectData} />\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/////////////////////////////\nconst ProjectTable = ({ projectData }) => {\n  return (\n    <div className=\"container\">\n      <h1 className=\"title\">{projectData[\"0\"][\"事業名\"]}</h1>\n      <h2 className=\"has-text-weight-bold\">府省庁</h2>\n      <p style={{ marginLeft: \"0.75rem\", marginbottom: \"1.0rem\" }}>\n        {projectData[\"0\"][\"府省庁\"]}\n      </p>\n      <h2 className=\"has-text-weight-bold\">当初予算(百万円)</h2>\n      <p style={{ marginLeft: \"0.75rem\", marginbottom: \"1.0rem\" }}>\n        {projectData[\"0\"][\"当初予算\"]}\n      </p>\n      <h2 className=\"has-text-weight-bold\">補正予算(百万円)</h2>\n      <p style={{ marginLeft: \"0.75rem\", marginbottom: \"1.0rem\" }}>\n        {projectData[\"0\"][\"補正予算\"]}\n      </p>\n      <h2 className=\"has-text-weight-bold\">執行額(百万円)</h2>\n      <p style={{ marginLeft: \"0.75rem\", marginbottom: \"1.0rem\" }}>\n        {projectData[\"0\"][\"執行額\"]}\n      </p>\n      <h2 className=\"has-text-weight-bold\">事業の目的</h2>\n      <p style={{ marginLeft: \"0.75rem\", marginbottom: \"0.8rem\" }}>\n        {projectData[\"0\"][\"事業の目的\"]}\n      </p>\n      <h2 className=\"has-text-weight-bold\">事業概要</h2>\n      <p\n        style={{\n          marginLeft: \"0.75rem\",\n          marginbottom: \"0.8rem\",\n        }}\n      >\n        {projectData[\"0\"][\"事業概要\"]}\n      </p>\n    </div>\n  );\n};\n\n//////////////////////\nconst DrawHistogram = ({ nodeLeavesData }) => {\n  const contentWidth = 300;\n  const contentHeight = 100;\n\n  const margin = {\n    left: 30,\n    right: 50,\n    top: 20,\n    bottom: 50,\n  };\n\n  const width = contentWidth + margin.left + margin.right;\n  const height = contentHeight + margin.top + margin.bottom;\n\n  const projectsMoney = [];\n  for (const node of nodeLeavesData) {\n    projectsMoney.push(node[\"執行額\"]);\n  }\n\n  const binCol = \"blue\";\n\n  const xScale = d3\n    .scaleLinear()\n    .domain([0, d3.max(projectsMoney)])\n    .range([0, contentWidth])\n    .nice();\n\n  const histogramData = d3\n    .histogram()\n    .domain(xScale.domain())\n    .thresholds(xScale.ticks(15))(projectsMoney);\n\n  const yScale = d3\n    .scaleLinear()\n    .domain([100, 0])\n    //.domain([d3.max(histogramData, (item) => item.length), 0])\n    .range([0, contentHeight])\n    .nice();\n\n  return (\n    <div>\n      <svg viewBox={`0 0 ${width} ${height}`}>\n        <g transform={`translate(${margin.left}, ${margin.top})`}>\n          {xScale.ticks().map((x) => {\n            return (\n              <g transform={`translate(${xScale(x)},0)`}>\n                <line\n                  x1=\"0\"\n                  y1={contentHeight}\n                  x2=\"0\"\n                  y2={contentHeight + 2}\n                  stroke=\"black\"\n                />\n                <text y={contentHeight + 8} textAnchor=\"middle\" font-size=\"5\">\n                  {x}\n                </text>\n              </g>\n            );\n          })}\n          {yScale.ticks().map((y) => {\n            return (\n              <g transform={`translate(0,${yScale(y)})`}>\n                {Number.isInteger(y) ? (\n                  <line x1=\"-2\" y1=\"0\" x2=\"0\" y2=\"0\" stroke=\"black\" />\n                ) : null}\n                <line\n                  x1=\"0\"\n                  y1=\"0\"\n                  x2={contentWidth}\n                  y2=\"0\"\n                  stroke=\"gainsboro\"\n                />\n                <text x=\"-7\" y=\"1\" textAnchor=\"middle\" fontSize=\"5\">\n                  {Number.isInteger(y) ? y : null}\n                </text>\n              </g>\n            );\n          })}\n          {histogramData.map((bin, i) => {\n            return (\n              <g\n                key={i}\n                transform={`translate(${xScale(bin.x0)}, ${yScale(\n                  bin.length\n                )})`}\n              >\n                <rect\n                  x=\"0\"\n                  width={\n                    xScale(histogramData[0].x1) -\n                    xScale(histogramData[0].x0) -\n                    1\n                  }\n                  height={contentHeight - yScale(bin.length)}\n                  fill={binCol}\n                />\n              </g>\n            );\n          })}\n        </g>\n      </svg>\n    </div>\n  );\n};\n\nconst DrawStackedChart = ({ nodeLeavesData }) => {\n  const contentWidth = 200;\n  const contentHeight = 500;\n\n  const margin = {\n    left: 30,\n    right: 45,\n    top: 60,\n    bottom: 30,\n  };\n\n  const width = contentWidth + margin.left + margin.right;\n  const height = contentHeight + margin.top + margin.bottom;\n\n  let numberTotal = 0;\n  let moneyTotal = 0;\n\n  const labels = [\n    \"1~9\",\n    \"10~99\",\n    \"100~999\",\n    \"1,000~9,999\",\n    \"10,000~99,999\",\n    \"100,000~999,999\",\n    \"1,000,000~9,999,999\",\n    \"10,000,000~99,999,999\",\n  ];\n\n  const projectsMoneyDigit = [\n    { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0 },\n  ];\n  for (const node of nodeLeavesData) {\n    moneyTotal += node[\"執行額\"];\n    const numDigit = String(Math.floor(node[\"執行額\"])).length;\n    projectsMoneyDigit[0][String(numDigit)] += 1;\n    numberTotal += 1;\n  }\n\n  const stackChartData = d3\n    .stack()\n    .keys([\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\"])(projectsMoneyDigit);\n\n  //const stackChartData = stack(projectsMoneyDigit)\n\n  const color = d3.scaleOrdinal(d3.schemeSet1);\n\n  const yScale = d3\n    .scaleLinear()\n    .domain([100, 0])\n    //.domain([d3.max(histogramData, (item) => item.length), 0])\n    .range([0, contentHeight]);\n\n  return (\n    <div>\n      <h1 className=\"title\">\n        クリックされたノードまでに属する事業の執行額データ\n      </h1>\n      <p>\n        ここでは上の図でクリックされたノードまでに属す事業の執行額に関するデータを可視化しています。\n      </p>\n      <p>\n        下の帯グラフではクリックされたノードまでに含まれる全事業の執行額の桁数の割合を表しています。この図を見る事で、クリックしたノードまでに含まれる事業はどれぐらいの規模の事業が多いのかや、どれぐらいお金が使われているのかを知る事ができます。\n      </p>\n\n      <svg viewBox={`0 0 ${width} ${height}`}>\n        <g transform={`translate(${margin.left}, ${margin.top})`}>\n          <text x=\"-9\" y=\"-6\" textAnchor=\"middle\" fontSize=\"7\">\n            (%)\n          </text>\n          <text x=\"-30\" y=\"-25\" textAnchor=\"start\" fontSize=\"10\">\n            {`執行額合計:${moneyTotal}(百万円)`}\n          </text>\n\n          {yScale.ticks().map((y) => {\n            return (\n              <g transform={`translate(0,${yScale(y)})`}>\n                {Number.isInteger(y) ? (\n                  <line x1=\"-2\" y1=\"0\" x2=\"5\" y2=\"0\" stroke=\"black\" />\n                ) : null}\n\n                <text x=\"-9\" y=\"2\" textAnchor=\"middle\" fontSize=\"7\">\n                  {Number.isInteger(y) ? y : null}\n                </text>\n              </g>\n            );\n          })}\n          {stackChartData.map((d, i) => {\n            return (\n              <g\n                key={i}\n                transform={`translate(5, ${yScale(\n                  100 - (d[0][0] / numberTotal) * 100\n                )})`}\n              >\n                <rect\n                  width=\"95\"\n                  height={yScale(\n                    100 - ((d[0][1] - d[0][0]) / numberTotal) * 100\n                  )}\n                  fill={color(d.key)}\n                />\n                {((d[0][1] - d[0][0]) / numberTotal) * 100 > 4 ? (\n                  <g>\n                    <text\n                      x=\"105\"\n                      y={\n                        yScale(\n                          100 - (((d[0][1] - d[0][0]) / numberTotal) * 100) / 2\n                        ) + 4\n                      }\n                      textAnchor=\"start\"\n                      fontSize=\"10\"\n                    >\n                      {`約${Math.floor(\n                        ((d[0][1] - d[0][0]) / numberTotal) * 100\n                      )}%`}\n                    </text>\n                    <text\n                      x=\"47\"\n                      y={yScale(\n                        100 - (((d[0][1] - d[0][0]) / numberTotal) * 100) / 2\n                      )}\n                      textAnchor=\"middle\"\n                      fontSize=\"8\"\n                    >\n                      {`${labels[i]}`}\n                    </text>\n                  </g>\n                ) : null}\n              </g>\n            );\n          })}\n        </g>\n      </svg>\n    </div>\n  );\n};\nrender(<App />, document.querySelector(\"#content\"));\n"],"sourceRoot":""}